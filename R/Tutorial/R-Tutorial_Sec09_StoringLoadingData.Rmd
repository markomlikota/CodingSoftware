---
title: 'R: Tutorial & Collection of Useful Commands'
subtitle: '(for applications in economics)'
author: "Marko Mlikota, https://markomlikota.github.io"
output:
  html_document: 
    fig_width: 6
    fig_height: 3.75
    fig_caption: true
    highlight: zenburn
    toc: false
    toc_depth: 1
    toc_float: true
    number_sections: false
    css: style.css
  pdf_document:
    fig_width: 6
    fig_height: 3.75
    fig_caption: true
    highlight: zenburn
---


<style type="text/css">
body, td {
   font-size: 18px;
}
code.r{
  font-size: 16px;
}
pre {
  font-size: 16px
}
h1 {
  font-size: 35px;
  margin: 60px 0px 30px 0px;
}
h2 {
  font-size: 25px;
}
#TOC {
  color: black; 
}

</style>

<script>
  var height=$('#primary').height(); // Calculate primary wrapper height
  $('#secondary').height(height); // Set the height it to sidebar
</script>




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results=TRUE)
knitr::opts_chunk$set(warning=FALSE)
knitr::opts_chunk$set(message=FALSE)
knitr::opts_chunk$set(tidy=TRUE)
knitr::opts_chunk$set(fig.pos = "!H", out.extra = "")
#knitr::opts_chunk$set(fig.width=5, fig.height=3)
```


# Storing & Loading Data

```{r, echo=FALSE}

rm(list = ls()) # delete everything in workspace/environment
cat("\014")	# delete everything in console     


```

The following commands are useful for writing a dataframe to a file:

```{r, eval=FALSE}

dfA = data.frame(a = c(10,20,30), b = c("RA", "RB", "RC"))
dfB = data.frame(a = c(10,20,30), b = c("RA", "RB", "RC"))


# Write .csv files:

write.table(dfA, "myfile.csv",sep=",") 

# to preserve special encoding (e.g. cyrillic characters), use this:
library(readr)
write_excel_csv(x = dfA, file = "myfile.csv", col_names = T)



# Write .xslx files:

library(openxlsx)
write.xlsx(dfA,"myfile.xlsx")

# write several sheets: (same package)

wb = createWorkbook("whatever") # need to open a named workbook; name is irrelevant here
addWorksheet(wb, "alpha")
addWorksheet(wb, "beta")

writeData(wb,sheet="alpha",dfA)
writeData(wb,sheet="beta",dfB)

saveWorkbook(wb, "myfile.xlsx", overwrite = TRUE)


```

The following commands are useful for reading-in files (datasets) into R:

```{r, eval=FALSE}


# Read in .csv file:

# simply:
dfData = read.table("myfile.csv",sep=",")
# with more options:
dfData = read.csv("myfile.csv", header = TRUE, sep = ",", quote = "\"", dec = ",", fill = TRUE, comment.char = "", skip = 1, nrows = 4) 


# Read in .xslx file:

library(readxl)
dfData = read_excel("myfile.xlsx", sheet = "alpha") 

```

```{r, eval=FALSE}

# Read in .dta file:

library(haven)
myData = read_dta('myfile.dta') 
# (this command cannot be ran, as we don't have "myfile.dta" in our path)


# There are many packages to download data directly from some databases/websites.
# e.g. "quantmod" to download data from yahoo or FRED database, or "imfr" package for downloading data from IMF
# (more on them later)


# Download file from some url:
library(RCurl)
download.file("https://api.census.gov/data/1994/cps/basic/jan?tabulate=weight(PWCMPWGT)&col+PEEDUCA&row+PEMLR","./Data/1994jan",'libcurl')

```


In my experience, due to type conversion issues, it's much easier to work with csv files than with excel (xlsx) files in R. So you might want to convert any xlsx files you need first manually into csv files. (You can also do basic adjustments (like deleting unnecessary rows) manually in the xlsx/csv file, though this is discouraged, as you would like others to be able to replicate your whole data-manipulation process and therefore verify your work.)

```{r, eval=FALSE}

# If you have to load an xlsx file and some of its columns are not recognized as a numeric by R (but as a factor), 
# this can be useful:

indx = sapply(dfData, is.factor)
dfData[indx] = lapply(dfData[indx], function(x) as.numeric(as.character(x)))

# You might also need to convert columns of type "character" to type "numeric":
dfData[,-1] = lapply(dfData[,-1], function(x) as.numeric(x)) 
# (here it's done for all but first column, say because it contains a list of countrynames, which are supposed to be strings)

```

